# MNIST-EMP 手写数字与扩展非数字符号识别系统

## 项目概述



本项目是一个基于PyTorch的手写数字识别系统，**扩展**了原始的MNIST数据集，引入了名为"EMP"的自定义符号，该符号用于标记**“不是数字”**的图片。

系统包含完整的训练、测试和预测流程，能够相对较好的识别0-9的数字以及EMP符号（共11个类别）。

## 原理简述

### 数据处理流程

1. **训练阶段**：
   - 合并MNIST数据集（60,000张）和EMP数据集（1,600张）
   - 应用统一的数据增强和归一化
   - 使用Adam优化器训练CNN模型
2. **预测阶段**：
   - 输入预处理号的测试集（在test.py实现）或者任意尺寸（**建议长宽相等**）的彩色（黑白效果最佳）图像（在out-test.py中实现）
   - 自动转换为28x28灰度图像（如果没有经过预处理）
   - 应用自适应阈值处理和形态学操作
   - 使用训练好的模型进行分类预测

## 项目结构

### 主要代码文件

| 文件路径                  | 功能描述         |
| :------------------------ | :--------------- |
| `train.py`                | 模型训练脚本     |
| `test.py`                 | 模型测试脚本     |
| `out-test.py`             | 外部图像分类脚本 |
| `model.py`                | CNN模型定义      |
| `utils/custom_dataset.py` | 自定义数据集类   |

### 目录结构

```
mnist-emp-project/
├── data/                   # 数据目录
│   ├── emp/                # EMP数据
│   │   ├── train-1600/     # EMP训练图片（1600张）
│   │   └── test-400/       # EMP测试图片（400张）
│   └── MNIST/              # 自动创建的MNIST数据集
├── examples/               # 示例图片
├── input_images/           # 外部预测脚本的输入图片目录
├── preprocessed_images/    # 外部预测脚本生成的预处理图片
├── utils/                  # 工具类目录
│   └── custom_dataset.py   # 自定义数据集类
├── model.py                # 模型定义
├── train.py                # 训练脚本
├── test.py                 # 测试脚本
├── out-test.py             # 预测脚本
├── mnist_emp_model.pth     # 训练好的模型
├── prediction_results.txt  # 预测结果
└── requirements.txt        # 相关依赖
README.md                   # 说明文档
LICENSE                     # 许可证
```

## 使用方法

### 环境安装

1. 创建Python虚拟环境（可选）：

   ```
   python -m venv pytorch_env
   pytorch_env\Scripts\activate
   ```

2. 安装依赖库：

   ```
   pip install -r requirements.txt
   ```

### 进入路径

进入对应环境并使用cd命令进入项目文件夹目录。

### 训练模型

```
python train.py
```

### 测试模型

```
python test.py
```

### 预测外来图像

```
# 输入白底黑字图像
python out-test.py

# 输入黑底白字图像
python out-test.py --invert_colors

# 保留缓存并显示图像
python out-test.py --keep_cache --show_images
```

### 预测脚本参数（可选）

| 参数              | 描述                         | 默认值                     |
| :---------------- | :--------------------------- | :------------------------- |
| `--input_dir`     | 输入图片目录                 | `.\input_images`           |
| `--model_path`    | 模型文件路径                 | `.\mnist_emp_model.pth`    |
| `--cache_dir`     | 预处理图片缓存目录           | `.\preprocessed_images`    |
| `--output_file`   | 预测结果文件                 | `.\prediction_results.txt` |
| `--show_images`   | 显示预测结果图像             | 无（默认不显示）           |
| `--invert_colors` | 反转图像颜色（识别黑底白字） | 无（默认不反转）           |
| `--keep_cache`    | 保留之前的预处理图片         | 无（默认清空缓存）         |

默认时，为让模型正常识别，请提供白底黑字图片。

## 注意事项

1. out-test.py的结果也许没有那么好，这在一定程度上是因为预处理算法的设计。如果在绘制图片时笔刷过细，预处理二值化后，连续的笔画就可能失真，退化为离散的白点，造成识别困难。特别是弯曲笔画多的数字（如8，6，等等）失真更加严重。

2. 暂时的解决方法是使用更粗的笔刷。如果画布是700*700像素的，那么笔刷建议至少60像素。以此类推。

3. 本项目中所有文件路径使用了绝对路径，请在使用时改为相对路径或自己电脑的绝对路径。

4. EMP符号的意义是“不是数字”，这在一定程度上降低了对0-9数字的预测的准确性，因为如果写的不标准，那么就自然“不像数字”了。进行这种“不像数字”的判断并不一定要使用神经网络去专门训练，也可以从置信度入手，如，每个置信度的方差小于一个阈值，则认为“不是数字”。本项目主要提供了另一个角度的尝试。

5.  兼容性说明

    本项目代码自动检测并利用可用的计算资源：

    \- 如果检测到CUDA，则使用GPU加速计算

    \- 否则使用CPU进行计算

## 许可证

本项目采用MIT许可证，具体信息请查阅许可证文件。



项目维护者：**zyx-2048**

电子邮箱：zhengyunxiao543@163.com

最后更新日期：2025年8月19日